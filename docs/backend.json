{
  "entities": {
    "UserProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserProfile",
      "type": "object",
      "description": "Represents a user's profile within the TKN Fi RE application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the UserProfile entity."
        },
        "name": {
          "type": "string",
          "description": "User's full name."
        },
        "email": {
          "type": "string",
          "description": "User's email address.",
          "format": "email"
        },
        "country": {
          "type": "string",
          "description": "User's country of residence."
        },
        "state": {
          "type": "string",
          "description": "User's state of residence."
        },
        "planStatus": {
          "type": "string",
          "description": "User's subscription plan status (Free, Pro, Executive)."
        },
        "dutyStation": {
          "type": "string",
          "description": "User's duty station if applicable."
        },
        "rank": {
          "type": "string",
          "description": "User's rank if applicable."
        },
        "branch": {
          "type": "string",
          "description": "User's branch if applicable."
        },
        "financialGoal": {
          "type": "string",
          "description": "User's financial goal."
        }
      },
      "required": [
        "id",
        "name",
        "email",
        "country",
        "state",
        "planStatus"
      ]
    },
    "Deal": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Deal",
      "type": "object",
      "description": "Represents a financial deal analyzed and saved by a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Deal entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:N Deal)"
        },
        "dealName": {
          "type": "string",
          "description": "Name of the deal."
        },
        "dealType": {
          "type": "string",
          "description": "Type of deal (Rental Property, House Flip, Commercial Multifamily)."
        },
        "purchasePrice": {
          "type": "number",
          "description": "Purchase price of the property."
        },
        "monthlyCashFlow": {
          "type": "number",
          "description": "Monthly cash flow of the deal."
        },
        "cocReturn": {
          "type": "number",
          "description": "Cash on cash return of the deal."
        },
        "roi": {
          "type": "number",
          "description": "Return on investment for the deal."
        }
      },
      "required": [
        "id",
        "userId",
        "dealName",
        "dealType",
        "purchasePrice",
        "monthlyCashFlow",
        "cocReturn",
        "roi"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "UserProfile",
          "schema": {
            "$ref": "#/backend/entities/UserProfile"
          },
          "description": "Stores user profiles. Path-based ownership is enforced. The 'userId' path parameter is used to identify the user.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user (UID)."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/deals/{dealId}",
        "definition": {
          "entityName": "Deal",
          "schema": {
            "$ref": "#/backend/entities/Deal"
          },
          "description": "Stores financial deals analyzed and saved by users. Path-based ownership is enforced. The 'userId' path parameter is used to identify the owner, and the 'dealId' parameter identifies the deal.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user (UID) who owns the deal."
            },
            {
              "name": "dealId",
              "description": "The unique identifier for the deal."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to ensure Authorization Independence, DBAC, and QAPs. User profiles and deals are stored under the `/users/{userId}` collection, enabling path-based ownership for simple and secure access rules. The structure avoids `get()` calls in rules by relying on the implicit ownership derived from the path. Each user's data (profile and deals) resides within their own document space, ensuring that access control can be managed without needing to retrieve parent document data.\n\n**Authorization Independence:** Achieved by storing user-related data (deals) under the `/users/{userId}` path. No `get()` calls are needed to verify ownership.\n\n**QAPs Support:** Segregation of user data into distinct paths (`/users/{userId}/deals`) ensures secure list operations (users can only list deals under their own user ID).\n\n**DBAC:** Authorization relies on `request.auth.uid` and the path-based structure. No custom claims are used."
  }
}